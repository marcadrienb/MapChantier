<!DOCTYPE html>
<html>
<head>
  <title>Carte des chantiers</title>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBSm9kfPQqWWck-16_y5OUz1ObSyHmknWE&libraries=geometry" async defer></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <style>
    /* ... styles (inchangés) ... */
  </style>
</head>
<body onload="initMap()">
  <div id="map"></div>
  <div id="menu"></div>
  <script>
    let map;
    let markers = [];
    let data;
    let couleursEntites = {};

    async function initMap() {
      // ... (fetch CSV et parsing, inchangés)

            map = new google.maps.Map(document.getElementById("map"), {
              center: { lat: 46.5196535, lng: 6.6322734 }, // Lausanne
              zoom: 12,
              restriction: {
                latLngBounds: {
                  north: 47.8084,
                  south: 45.818,
                  west: 5.9559,
                  east: 10.4921,
                },
                strictBounds: true,
              }
            });

            createMarkers(data);
            createMenu();
          },
          error: function(error) {
            console.error("Erreur de parsing CSV :", error);
          }
        });
      } catch (error) {
        console.error("Erreur lors de la récupération du CSV :", error);
      }
    }

    function createMarkers(data) {
      let latLngBounds = new google.maps.LatLngBounds();

      data.forEach(row => {
        let latLng = new google.maps.LatLng(row.Latitude, row.Longitude);
        latLngBounds.extend(latLng);

        const marker = new google.maps.Marker({
          position: latLng,
          map: map,
          title: `N° Chantier : ${row["N° de chantier"]}`,
          icon: {
            path: google.maps.SymbolPath.CIRCLE,
            scale: Math.sqrt(row["CA+0"] / 100000) * 5 || 5,
            fillColor: couleursEntites[row.Entité],
            fillOpacity: 0.7,
            strokeWeight: 1,
          },
        });

        let infoWindowContent = `<div style="padding: 10px;">`;
        for (const key in row) {
          if (row.hasOwnProperty(key)) {
            infoWindowContent += `<p><b>${key}:</b> ${row[key]}</p>`;
          }
        }
        infoWindowContent += `</div>`;

        const infoWindow = new google.maps.InfoWindow({
          content: infoWindowContent,
        });

        marker.addListener("click", () => infoWindow.open(map, marker));
        markers.push(marker);
      });
      map.fitBounds(latLngBounds);
    }

    // ... (createMenu et filterMarkers, inchangés)
  </script>
</body>
</html>
